---
title: "Security: webhacking.kr 07-10"
last_modified_at: 2020-06-21T20:20:02-05:00
categories:
  - Security
tags:
  - webhacking.kr
  - 웹해킹
toc: true 
toc_label: "Table of Contents"
toc_icon: "cog"
toc_sticky: true 
author_profile: true 
read_time: false 
---

---
### 07 문제 풀이 (sha1 hash)
---


<figure class="align-center">
  <img src="{{ site.url }}{{ site.baseurl }}/assets/images/WebHacking.kr/문제7/7-1.JPG" alt="">
  <figcaption> </figcaption>
</figure>

7번 문제에 들어가니 Admin Page임을 알리는 문구와 auth 버튼이 있다. 버튼을 누르면 Access_Denied 알림창이 뜨도록 되어있다.
{: .notice}

```php
<?php
  include "../../config.php";
  if($_GET['view_source']) view_source();
?><html>
<head>
<title>Challenge 7</title>
</head>
<body>
<?php
$go=$_GET['val'];
if(!$go) { echo("<meta http-equiv=refresh content=0;url=index.php?val=1>"); }
echo("<html><head><title>admin page</title></head><body bgcolor='black'><font size=2 color=gray><b><h3>Admin page</h3></b><p>");
if(preg_match("/2|-|\+|from|_|=|\\s|\*|\//i",$go)) exit("Access Denied!");
$db = dbconnect();
$rand=rand(1,5);
if($rand==1){
  $result=mysqli_query($db,"select lv from chall7 where lv=($go)") or die("nice try!");
}
if($rand==2){
  $result=mysqli_query($db,"select lv from chall7 where lv=(($go))") or die("nice try!");
}
if($rand==3){
  $result=mysqli_query($db,"select lv from chall7 where lv=((($go)))") or die("nice try!");
}
if($rand==4){
  $result=mysqli_query($db,"select lv from chall7 where lv=(((($go))))") or die("nice try!");
}
if($rand==5){
  $result=mysqli_query($db,"select lv from chall7 where lv=((((($go)))))") or die("nice try!");
}
$data=mysqli_fetch_array($result);
if(!$data[0]) { echo("query error"); exit(); }
if($data[0]==1){
  echo("<input type=button style=border:0;bgcolor='gray' value='auth' onclick=\"alert('Access_Denied!')\"><p>");
}
elseif($data[0]==2){
  echo("<input type=button style=border:0;bgcolor='gray' value='auth' onclick=\"alert('Hello admin')\"><p>");
  solve(7);
}
?>
<a href=./?view_source=1>view-source</a>
</body>
</html>
```

* **위의 코드에서 중요한 부분만 해석해보자면,**
* val로 부터 값을 받아 $go에 넣는다(.../challenge/web-07/index.php?val=1)
* $go의 값이 null이면 url에 새로고침하면서 index.php?val=1이 들어가도록한다.
* if(preg_match(~)) 부분은 $go를 정규표현식으로 검사하는 함수다. 아래와 같은 조건을 만족할시 Access Denied 출력하며 빠져나온다.
	* 2 - + from _ = \s * /  중 하나라도 포함하면 안된다.
* 위의 조건에 해당하지 않은 경우 data base를 연결하고 1~5 사이의 랜덤값을 받아 $rand에 넣는다.
* $rand 값으로 만족하는 if 문을 실행한다.
	* if문에서는 mysqli_query을 통하여 $go와 lv이 일치하는 레코드를 질의한다.
	* 여기서 특이한점은 lv=($go) 괄호의 개수가 rand 수에 따라 다르게 설정되어있다.
	* 좌측 함수의 실행에 실패할경우 우측의 die 함수를 실행한다.
{: .notice}
























