---
title: "Network: NAT"
last_modified_at: 2020-08-17T20:20:02-05:00
categories:
  - Network
tags:
  - NAT
toc: true 
toc_label: "Table of Contents"
toc_icon: "cog"
toc_sticky: true 
author_profile: true 
read_time: false 
---

---
### NAT 개념
---

**NAT(network address translation)는** 외부와 라우팅이 불가능한 사설 IP주소를 
공인 IP 주소로 변환하여 외부와 통신이 가능하게 만들거나, 조직 내부의 주소가 
외부로 공개되지 않도록 하여 보안을 강화하기 위한 목적으로 만들어졌다. 
NAT는 IP 패킷의 출발지 또는 목적지 IP 주소를 다른 IP 주소로 변환할 수 있으며, 
설정에 따라 전송 계층의 TCP/UDP 포트 변호도 변환할 수 있다. 
{: .notice}--info

공인 IP가 부족할 경우 포트번호도 변환하여 사용하는 것 -> PAT
{: .notice}

* 목적
* 경계 라우터에서 NAT 기능을 설정
* 외부에 알려줄 IP가 변경되었을 때, 내부망 모든 장비의 IP 주소를 변경하려면 상당한 시간이 소요되기 때문에 NAT 설정만으로 변경된 IP를 통해 통신할 수 있게한다.
* 보안의 목적으로 주소 변환 기능을 사용하면 내부 IP 주소가 외부에 알려지지 않기 때문에, 외부로부터 직접적인 공격을 막을 수 있다. 
{: .notice--info}

* 유형
* NAT 설정은 다음의 두 가지 유형이 가능하다. 하나는 도메인 기반의 NAT이고,
* 다른 하나는 NVI(NAT Virtual Interface) 기반의 NAT이다.
* 도메인 기반의 NAT 설정에서는 NAT 장비를 기준으로 inside, outside 도메인이 존재해야만 주소 변환이 동작한다. Local Address는 컴퓨터가 직접 사용하는 주소다(내부망에서 사용하는 주소, 보통은 사설 아주 가끔 공인을 사용한다), Global address는 인터넷으로 내보내기 위한 주소 (반드시 공인 IP 주소)
	* Inside local: 내부망 안에서 사용
	* Inside Global: (같은 내부망의 호스트) local 주소 대신 외부로 나가는 주소 = 출발지
	* Outside Local: 다른 도메인 호스트의 외부로 나가는 주소 = 도착지
	* Outside Global: 다른 도메인 호스트가 사용하는 공인 주소
	* NAT를 사용하지x Outside Local = Outside Global(공인 주소 사용) 경우도 있다
{: .notice--warning}

그렇다면 Ping을 한다고 가정했을 때, 패킷 모양은 다음과 같다.
{: .notice}

```
출발지: 192.168.100.5
목적지:192.168.200.10
ICMP
```

목적지로는 Outside Local 주소를 사용한다. 이러한 패킷이 라우터를 통해 나간다고 가정하자. 
패킷의 모양은 되돌아올 수 있도록 출발지도 공인으로 도착지도 잘 찾아가도록 공인 ip로 바뀌어야한다.
{: .notice}

```
출발지: 7.7.7.7
도착지: 8.8.8.10
ICMP
```

이 패킷이 도착지 쪽 라우터로 갔을 때 다시 도착 주소가 변환되어야 한다.
{: .notice}

정리 하면 출발지를 기준으로 봤을 때 내부에서는 inside local로 출발하여 라우터를 통해 inside Global 로 변환됨. 
도착지 주소의 경우 outside local에서 outside global로 변환되었다가 도착지 서브넷으로 들어가는 라우터에서(nat 설정이 된곳) outside local 로 다시 변환된다. (또는 NAT를 사용하지 않는 호스트의 경우 같은 주소를 사용하기도 함)
{: .notice}


* NAT를 사용하기 위해서는 라우터에 주소를 알아보고 변환할 수 있도록 정책이 필요하다.
* 사설 IP 대역: 192.168.100.0/24 (ACL을 통해 지정)
* 공인 IP 대역: 7.7.7.1 ~ 7.7.7.100 (IP NAT POOL)
* 사설 ip 대역과 공인 IP 대역 매핑(IP NAT INSIDE)
{: .notice}

```
Ip access-list standard Private
Permit 19.168.100.5 ~
Ip nat pool Public 7.7.7.7 ~
Ip nat inside source ~
```

Inside 가 출발지 -> local 서브넷 안, global 서브넷 밖   
Outside 가 도착지 -> local 서브넷 안, global 서브넷 밖  
{: .notice}

