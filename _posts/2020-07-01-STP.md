---
title: "Network: Spanning Tree"
last_modified_at: 2020-06-01T20:20:02-05:00
categories:
  - Network
tags:
  - STP
  - Spanning Tree
toc: true 
toc_label: "Table of Contents"
toc_icon: "cog"
toc_sticky: true 
author_profile: true 
read_time: false 
---

---
### 스패닝 트리 프로토콜 개념
---

* 이더넷 프레임 루핑: 이더넷 프레임이 장비들 사이에서 패킷이 돌고 돈다
* 스위치에서 이러한 이더넷 프레임 루핑을 방지해주는 것이 STP(Spanning Tree Protocol)
* IP 패킷의 경우 TTL 필드가 무한 루프를 방지해줌
{: .notice}

* 이더넷 프레임 루핑은 브로드캐스트 스톰을 발생시킨다
* 프레임이 Looping 되면서 MAC 주소 테이블을 수시로 변경시킨다 (Mac table 불안정)
* 이중 프레임 수신 (동일한 프레임 여러개 수신)
* STP가 looping을 해결하지 못할 때는 물리적 looping을 찾아 해결한다
{: .notice}

---
### 토폴로지 기본 설정
---

```
Router(config)# host R1
R1(config)# no ip domain-lookup
R1(config)# enable secret cisco

R1(config)# line console 0
R1(config-line)# logg sync
R1(config-line)# exec-t 0

R1(config-line)# line vty 0 4
R1(config-line)# password cisco
```

```
R1(config)# interface f0/0
R1(config-if)# ip address 1.1.1.1 255.255.255.0
R1(config-if)# no shut

R1(config)# interface f0/1
R1(config-if)# ip address 1.1.1.2 255.255.255.0
R1(config-if)# no shut
```

```
SW1(config)# interface f1/10
SW1(config-if)# shut

SW1(config)# interface f1/10
SW1(config-if)# shut
```

```
SW#2 show cdp neighbors
```

---
### STP 동작 
---

STP가 동작하면 물리적으로 루프 구조인 네트워크에서 특정 포트를 차단 상태로 바꾸어 논리적으로 루프가 발생하지 않도록한다
{: .notice}

* BPDU(Bridge Protocol Unit): STP는 BPDU 프레임을 이용하여 루프가 없는 경로를 구성한다
* 설정 BPDU: 스위치 및 포트 역할을 결정하기 위하여 사용
* TCN (Topology Change Notification) BPDU: 네트워크 구조 변경시 알리기 위해 사용
{: .notice}

* STP의 동작 순서
	* root 스위치 선택: bridge ID (priority + Mac address)
	* root 포트 선택: root 스위치 외 다른 모든 스위치는 root 포트를 선택한다
		* 경로값의 합이 최소
		* 인접 스위치 bridge ID 낮은 포트
		* 인접 스위치 port ID 낮은 포트
	* Designated 포트 선택: 한 세그먼트(스위치 간 연결) 당 하나씩 있어야한다
* VLAN당 하나의 STP가 동작하는 것을 PVST라고 부른다
{: .notice--warning}















