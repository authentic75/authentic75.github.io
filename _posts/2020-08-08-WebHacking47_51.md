---
title: "Security: webhacking.kr 47-51"
last_modified_at: 2020-08-08T20:20:02-05:00
categories:
  - Security
tags:
  - webhacking.kr
  - 웹해킹
toc: true 
toc_label: "Table of Contents"
toc_icon: "cog"
toc_sticky: true 
author_profile: true 
read_time: false 
---

---
### 47 문제풀이 (Mail Header Injection)
---
---
#### Mail Header Injection
---

**Mail Header Injection이란?**  
공격자가 메시지에 추가 헤더를 삽입하여 메일서버가 의도한 것과 다르게 동작하도록 지시하는 것으로 
이 페이지에서는 이메일 헤더에 cc(참조)나 Bcc(숨은 참조)를 추가하여 관리자에게만 
보내는 메일을 다른 사람들에게 참조를 하여 메일을 보낼 수 있는 취약점이다. 
{: .notice}

예를 들면 공격자는 메일 주소로 아래의 데이터를 리퀘스트로 보냅니다
bob@hackr.jp$0D%0ABcc: user@example.com
%0D%0A는 메일 메시지에서 개행 문자를 의미합니다. 즉 수신자에 bcc가 몰래 추가되게 됩니다.
같은 방법으로 To나 Subject 등에 임의의 메일 헤더를 쓰거나 본문에 첨부파일을 추가 하는게 가능합니다.
출처: https://blog.sonim1.com/103 [Kendrick's Blog]
{: .notice}

---
#### 문제풀이
---

47번 문제를 보니 Mail subject를 입력하는 란이 보인다. send를 눌러보자.
{: .notice}

<figure class="align-center">
  <img src="{{ site.url }}{{ site.baseurl }}/assets/images/WebHacking.kr/문제47/47-1.JPG" alt="">
  <figcaption> </figcaption>
</figure>

<figure class="align-center">
  <img src="{{ site.url }}{{ site.baseurl }}/assets/images/WebHacking.kr/문제47/47-2.JPG" alt="">
  <figcaption> </figcaption>
</figure>

Flag값을 메일로 보내주는 모양이다 그런데 이상한 점은 도착 메일이 고정되어있다. 이를 수정하거나 내 메일 주소를 추가해야한다.
{: .notice}


<figure class="align-center">
  <img src="{{ site.url }}{{ site.baseurl }}/assets/images/WebHacking.kr/문제47/47-3.JPG" alt="">
  <figcaption> </figcaption>
</figure>

그냥 텍스트 창에 0D%0ACc:메일ID@naver.com를 입력해보니 엔터값이 그대로 문자로 들어가서 메일을 받을 수 없었다. 그래서 Burp suite를 활용하여 CC로 내 메일을 추가했다.
{: .notice}


<figure class="align-center">
  <img src="{{ site.url }}{{ site.baseurl }}/assets/images/WebHacking.kr/문제47/47-4.JPG" alt="">
  <figcaption> </figcaption>
</figure>

<figure class="align-center">
  <img src="{{ site.url }}{{ site.baseurl }}/assets/images/WebHacking.kr/문제47/47-5.JPG" alt="">
  <figcaption> </figcaption>
</figure>

그리고 Cc가 잘 들어갔음을 볼 수 있었다.
{: .notice}

<figure class="align-center">
  <img src="{{ site.url }}{{ site.baseurl }}/assets/images/WebHacking.kr/문제47/47-6.JPG" alt="">
  <figcaption> </figcaption>
</figure>

<figure class="align-center">
  <img src="{{ site.url }}{{ site.baseurl }}/assets/images/WebHacking.kr/문제47/47-7.JPG" alt="">
  <figcaption> </figcaption>
</figure>

실제 메일로 Flag 값이 온 것을 볼 수 있었다. Clear!
{: .notice}

---
### 48 문제풀이
---

48번 문제에 들어가보니 파일을 업로드하는 란이 보인다. 파일을 업로드 하니 시간, id, 입력한 메모가 보인다.
{: .notice}


<figure class="align-center">
  <img src="{{ site.url }}{{ site.baseurl }}/assets/images/WebHacking.kr/문제48/48-1.JPG" alt="">
  <figcaption> </figcaption>
</figure>

파일을 업로드 하거 나 삭제할 때를 burp suite로 캡처해서 보니 mode=del 같은 명령어가 왔다 갔다 하는 것이 보인다.
{: .notice}

<figure class="align-center">
  <img src="{{ site.url }}{{ site.baseurl }}/assets/images/WebHacking.kr/문제48/48-2.JPG" alt="">
  <figcaption> </figcaption>
</figure>

어떻게 할까 고민하다가 파일명 뒤에 ; 을 붙이고 ls을 입력했다. 그리고 파일을 업로드 했는데 아무 반응이 없었다.
{: .notice}

<figure class="align-center">
  <img src="{{ site.url }}{{ site.baseurl }}/assets/images/WebHacking.kr/문제48/48-4.JPG" alt="">
  <figcaption> </figcaption>
</figure>

도로 파일을 삭제해보니 갑자기 파일 이름들과 함께 FLAG가 보였다.
{: .notice}

<figure class="align-center">
  <img src="{{ site.url }}{{ site.baseurl }}/assets/images/WebHacking.kr/문제48/48-3.JPG" alt="">
  <figcaption> </figcaption>
</figure>

Clear!
{: .notice}

<figure class="align-center">
  <img src="{{ site.url }}{{ site.baseurl }}/assets/images/WebHacking.kr/문제48/48-5.JPG" alt="">
  <figcaption> </figcaption>
</figure>


---
### 49 문제풀이
---

이 문제는 어디서 많이 봤던 문제다. 소스코드부터 보자.
{: .notice}

<figure class="align-center">
  <img src="{{ site.url }}{{ site.baseurl }}/assets/images/WebHacking.kr/문제49/49-1.JPG" alt="">
  <figcaption> </figcaption>
</figure>

```
<?php
  include "../../config.php";
  if($_GET['view_source']) view_source();
?><html>
<head>
<title>Challenge 49</title>
</head>
<body>
<h1>SQL INJECTION</h1>
<form method=get>
level : <input name=lv value=1><input type=submit>
</form>
<?php
  if($_GET['lv']){
    $db = dbconnect();
    if(preg_match("/select|or|and|\(|\)|limit|,|\/|order|cash| |\t|\'|\"/i",$_GET['lv'])) exit("no hack");
    $result = mysqli_fetch_array(mysqli_query($db,"select id from chall49 where lv={$_GET['lv']}"));
    echo $result[0] ;
    if($result[0]=="admin") solve(49);
  }
?>
<hr><a href=./?view_source=1>view-source</a>
</body>
</html>
```

select, or, and, \, (, ), limit, , 등등을 피해 SQL injection을 해보자.
{: .notice}

```
?lv=0||id=0x61646D696E
```

or를 대신해 ||를 사용하고 ( )를 사용하지 못해서 char()대신 hex 값을 사용한다.
{: .notice}


<figure class="align-center">
  <img src="{{ site.url }}{{ site.baseurl }}/assets/images/WebHacking.kr/문제49/49-2.JPG" alt="">
  <figcaption> </figcaption>
</figure>

Clear!
{: .notice}


---
### 50 문제풀이
---




---
### 51 문제풀이
---



