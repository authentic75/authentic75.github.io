---
title: "LINUX: Quota"
last_modified_at: 2020-05-11T16:20:02-05:00
categories:
  - LINUX
tags:
  - Quota
  - LINUX
  - 용량제한
  - 용량권한
toc: true #Table Of Contents 목차 보여줌
toc_label: "My Table of Contents" # toc 이름 정의
toc_icon: "cog" #font Awesome아이콘으로 toc 아이콘 설정
toc_sticky: true # 스크롤 내릴때 같이 내려가는 목차
author_profile: true #작성자 프로필 출력여부 #false
read_time: false # read_time을 출력할지 여부 1min read 같은것!

---
### Disk Quota
---
**사용자별 공간 할당**  
파일 시스템(파티션) 마다 사용자가 생성할 수 있는 파일과 디렉토리 용량 제한
{: .notice}
Quota는 **전체 합산 용량**을 제한한다. 그래서 보통 root 채로 제한하기 보다는
파티션 sdb1 sdc1을 생성했다고 가정했을때, **/home 같이 고정적인 곳은 1GB**로 제한되고
**tmp는 임시파일이 저장되므로 500MB**로 제한한다. 
그리고 제한을 넘어서면 **파일 제거 정책**을 정해줄 수 있다.
{: .notice}
```console
#기본 파티션 생성 후 유저 생성
root@ns1:~# fdisk /dev/sdb
root@ns1:~# fdisk /dev/sdc
root@ns1:~# tar cf /tmp/file1 /etc
root@ns1:~# useradd user1
root@ns1:~# passwd user1 
root@ns1:~# df -m
```
**user1**
```console
[user1@ns1 ~]$ cp /tmp/file1 ./file1
[user1@ns1 ~]$ cp /tmp/file1 ./file2
```
user1로 로그인한 후 다음과 같이 파일을 반복 생성하는 스크립트를 작성해보았다.
{: .notice}
```python
import os
num =1
while True:
	filename = "file%d"%num
	num +=1
	os.system("cp ./tmp/file1 ~/%s"%filename)
```
user1로 로그인한 후 다음과 같이 파일을 반복 생성하는 스크립트를 작성해보았다.  
**종료는 ps -u user1로 bash PID를 확인한 후 kill 한다.**  
아무의미 없다 그냥 해봤다.
{: .notice}
---
#### quotacheck 명령어
---
```console
[user1@ns1 ~]$ mount | grep sdb #sdb를 마운트하는 과정까지 진행해놓자
[user1@ns1 ~]$ vi /etc/fstab
[user1@ns1 ~]$ mount -o remount /home
[user1@ns1 ~]$ quotacheck /home
[user1@ns1 ~]$ ls -lh /home
```
**/etc/fstab**  
/dev/sdb1 /home ext3 **defaults,usrquota** 1 2
{: .notice}
aquata.user가 생긴 것을 볼 수 있다.  
QUOATA DB가 생성된 것을 의미합니다.
{: .notice}
---
#### quotaon과 quotaoff
---
```console
[user1@ns1 ~]$ quotaon /home
[user1@ns1 ~]$ quotaoff /home
[user1@ns1 ~]$ quotaon -a
[user1@ns1 ~]$ quotaoff -a
[user1@ns1 ~]$ quotaoff -a -u -g -v
```
quotaon/off로 quota 동작을 활성화/비활성화 해준다  
옵션  
-a = all , -v = view, -g = group, -u = user
{: .notice}
---
### QUOTA를 만들어보자
---
Sdb와  sdc를 각각 1개의 단일 파티션으로 생성  
Sdb1 sdc1을 ext3 파일시스템으로 생성한 후  
Sdb1 -> /home Sdc1 -> /test 마운트 해준다.  
그리고 계정 5개를 생성한다 (이때 /home 디렉토리는 다른 계정 없이 비어 있어야 한다.)
{: .notice}
```console
[root@ns1 ~]# fdisk /dev/sdb
[root@ns1 ~]# fdisk /dev/sdc

[root@ns1 ~]# mkfs -t ext3 /dev/sdb1
[root@ns1 ~]# mount /dev/sdb1 /home

[root@ns1 ~]# mkfs -t ext3 /dev/sdc1
[root@ns1 ~]# mkdir /test
[root@ns1 ~]# mount /dev/sdc1 /test

[root@ns1 ~]# mount | grep sdb1
[root@ns1 ~]# mount | grep sdc1  
[root@ns1 ~]# df -Th | grep "sdb1\|sdc1" 
```
```console
[root@ns1 ~]# useradd user1
[root@ns1 ~]# useradd user2
[root@ns1 ~]# useradd user3
[root@ns1 ~]# useradd user4
[root@ns1 ~]# useradd user5

[root@ns1 ~]# vi /etc/fstab
[root@ns1 ~]# quotacheck -m -u -a

```
/dev/sdb1               /home                   ext3    defaults,usrquota 1 2  
오타가 나면 적용이 안되니, 잘 확인해보자
{: .notice}
```console

```