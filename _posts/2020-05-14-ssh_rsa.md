---
title: "LINUX: ssh와 rsa 등록"
last_modified_at: 2020-05-12T16:20:02-05:00
categories:
  - LINUX
tags:
  - rsa
  - ssh
  - LINUX
toc: true 
toc_label: "Table of Contents"
toc_icon: "cog"
toc_sticky: true 
author_profile: true 
read_time: false 
---
---
### known_hosts 확인하기
---
먼저 ssh의 동작을 확인하기위해 127.0.0.1 주소로 연결을 시도해보자.  
(4계층 방화벽 신경쓰지 않고 오로지 7계층의 서비스만 확인할 수 있는 장점)
{: .notice--info}

```  console
[root@ns1 ~]# ssh 127.0.0.1
The authenticity of host '127.0.0.1 (127.0.0.1)' can't be established.
RSA key fingerprint is 5f:58:b6:d9:6d:15:c5:96:53:72:f8:10:23:7a:83:18.
Are you sure you want to continue connecting (yes/no)? y
Please type 'yes' or 'no': yes
Warning: Permanently added '127.0.0.1' (RSA) to the list of known hosts.
root@127.0.0.1's password:
# 컨트롤 C 를 눌러서 종료
```
결과로 .ssh 아래 known_hosts에 rsa key가 추가되었다
{: .notice}
```  console
[root@ns1 ~]# ls -lhd .ssh
drwx------ 2 root root 4.0K  5월  6 11:03 .ssh
[root@ns1 ~]# ls -lh .ssh
합계 4.0K
-rw-r--r-- 1 root root 391  5월  6 11:03 known_hosts
[root@ns1 ~]# cat -n .ssh/known_hosts
1  127.0.0.1 ssh-rsa AAAAB3NzaC1yc2EAAAABIwAAAQEAyAtLBQCkLsHQlh ...
[root@ns1 ~]# cat /etc/ssh/ssh_host_rsa_key.pub
ssh-rsa AAAAB3NzaC1yc2EAAAABIwAAAQEAyAtLBQCkLsHQlh ...
``` 
known_hosts에 추가된 rsa key와 /etc/ssh/ssh_host_rsa_key.pub 를 살펴보면 같은 값이 추가됨을 알 수 있다.
{: .notice}

* 방금 발생한 통신과정을 살펴보자
* 7계층 Ssh을 실행하면 랜덤한 PID로 실행 4계층 클라이언트에서는 1024 포트번호를 발생시킵니다.
* 서버에서는 루프백 주소로 받고(3계층) 22번 포트로 받게 되고(4계층) sshd라고 하는 데몬 프로그램이 받는다.(7계층)
* 이러한 과정을 볼 수 있는 명령어가 netstat 이다.
{: .notice--info}
재접속시 이 키를 가지고 암호화 통신을 한다. 만약 서버와의 키 값이 다르다! 그러면 중간자 공격에 노출되기 쉬운 상황인 것이다. 내 실수라면 파일을 지우고 다시 받으면 그만이지만 그게 아니라면 조심하자!
{: .notice}

---
### 공개키 인증방식(rsa) 로그인
---

* cat /etc/ssh/ssh_config 에서 다음과 같은 내용을 봤을 것이다.
* 인증에 사용되는 파일 들이다.
{: .notice}
```
#   IdentityFile ~/.ssh/identity
#   IdentityFile ~/.ssh/id_rsa	비밀키값
#   IdentityFile ~/.ssh/id_dsa
```

---
#### 공개키 인증의 순서
---
1. 접속할 서버의 인증서(공개키)를 계정의 홈 디렉토리에 저장한다.
	* IdentityFile ~/.ssh/id_rsa 비밀키
	* IdentityFile ~/.ssh/id_rsa.pub 공개키
	* 서버는 클라이언트로부터 공개키를 받아서 ~/.ssh/authorized_keys 에 저장
2. 암호인증이나 공개 키 인증으로 접근할 경우
	* 2-1. 공개키인증은 접속하려는 계정의 홈디렉토리 아래의 authorized_keys에 등록되어있는지 확인 후 인증을 허용합니다. (우선순위가 높아서 먼저 검사한다)
	* 2-2. 암호 인증은 공개키 저장 여부와 상관없이 Password로 인증을 합니다
{: .notice--info}



























